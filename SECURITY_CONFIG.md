# kkFileView å®‰å…¨é…ç½®æŒ‡å—

## âš ï¸ é‡è¦å®‰å…¨æ›´æ–°

ä» 4.4.0 ä¹‹åç‰ˆæœ¬å¼€å§‹ï¼ŒkkFileView å¢å¼ºäº†å®‰å…¨æ€§ï¼Œé»˜è®¤æ‹’ç»æ‰€æœ‰æœªé…ç½®çš„å¤–éƒ¨æ–‡ä»¶é¢„è§ˆè¯·æ±‚ï¼Œä»¥é˜²æ­¢ SSRFï¼ˆæœåŠ¡å™¨ç«¯è¯·æ±‚ä¼ªé€ ï¼‰æ”»å‡»ã€‚

## ğŸ”’ å®‰å…¨é…ç½®è¯´æ˜

### 1. ä¿¡ä»»ä¸»æœºç™½åå•é…ç½®ï¼ˆæ¨èï¼‰

åœ¨ `application.properties` ä¸­é…ç½®å…è®¸é¢„è§ˆçš„åŸŸåï¼š

```properties
# æ–¹å¼1ï¼šé€šè¿‡é…ç½®æ–‡ä»¶
trust.host = kkview.cn,yourdomain.com,cdn.example.com

# æ–¹å¼2ï¼šé€šè¿‡ç¯å¢ƒå˜é‡
KK_TRUST_HOST=kkview.cn,yourdomain.com,cdn.example.com
```

**ç¤ºä¾‹åœºæ™¯**ï¼š
- åªå…è®¸é¢„è§ˆæ¥è‡ª `oss.aliyuncs.com` å’Œ `cdn.example.com` çš„æ–‡ä»¶
```properties
trust.host = oss.aliyuncs.com,cdn.example.com
```

### 2. å…è®¸æ‰€æœ‰ä¸»æœºï¼ˆä¸æ¨èï¼Œä»…æµ‹è¯•ç¯å¢ƒï¼‰

```properties
trust.host = *
```

âš ï¸ **è­¦å‘Š**ï¼šæ­¤é…ç½®ä¼šå…è®¸è®¿é—®ä»»æ„å¤–éƒ¨åœ°å€ï¼Œå­˜åœ¨å®‰å…¨é£é™©ï¼Œä»…åº”åœ¨æµ‹è¯•ç¯å¢ƒä½¿ç”¨ï¼

### 3. é»‘åå•é…ç½®ï¼ˆé«˜çº§ï¼‰

ç¦æ­¢ç‰¹å®šåŸŸåæˆ–å†…ç½‘åœ°å€ï¼š

```properties
# ç¦æ­¢è®¿é—®å†…ç½‘åœ°å€ï¼ˆå¼ºçƒˆæ¨èï¼‰
not.trust.host = localhost,127.0.0.1,192.168.*,10.*,172.16.*,169.254.*

# ç¦æ­¢ç‰¹å®šæ¶æ„åŸŸå
not.trust.host = malicious-site.com,spam-domain.net
```

**ä¼˜å…ˆçº§**ï¼šé»‘åå• > ç™½åå•

### 4. Docker ç¯å¢ƒé…ç½®

```bash
docker run -d \
  -e KK_TRUST_HOST=yourdomain.com,cdn.example.com \
  -e KK_NOT_TRUST_HOST=localhost,127.0.0.1 \
  -p 8012:8012 \
  keking/kkfileview:4.4.0
```

## ğŸ›¡ï¸ å®‰å…¨æœ€ä½³å®è·µ

### âœ… æ¨èé…ç½®

```properties
# 1. æ˜ç¡®é…ç½®ä¿¡ä»»ä¸»æœºç™½åå•
trust.host = your-cdn.com,your-storage.com

# 2. é…ç½®é»‘åå•é˜²æ­¢å†…ç½‘è®¿é—®
not.trust.host = localhost,127.0.0.1,192.168.*,10.*,172.16.*

# 3. ç¦ç”¨æ–‡ä»¶ä¸Šä¼ ï¼ˆç”Ÿäº§ç¯å¢ƒï¼‰
file.upload.disable = true

# 4. é…ç½®åŸºç¡€URLï¼ˆä½¿ç”¨åå‘ä»£ç†æ—¶ï¼‰
base.url = https://preview.yourdomain.com
```

### âŒ ä¸æ¨èé…ç½®

```properties
# å±é™©ï¼šå…è®¸æ‰€æœ‰ä¸»æœºè®¿é—®
trust.host = *

# å±é™©ï¼šå¯ç”¨æ–‡ä»¶ä¸Šä¼ ï¼ˆç”Ÿäº§ç¯å¢ƒï¼‰
file.upload.disable = false
```

## ğŸ” é…ç½®éªŒè¯

### æµ‹è¯•ç™½åå•æ˜¯å¦ç”Ÿæ•ˆ

1. é…ç½®ç™½åå•ï¼š
```properties
trust.host = kkview.cn
```

2. å°è¯•é¢„è§ˆç™½åå•å†…çš„æ–‡ä»¶ï¼š
```
http://localhost:8012/onlinePreview?url=https://kkview.cn/test.pdf
âœ… åº”è¯¥å¯ä»¥æ­£å¸¸é¢„è§ˆ
```

3. å°è¯•é¢„è§ˆç™½åå•å¤–çš„æ–‡ä»¶ï¼š
```
http://localhost:8012/onlinePreview?url=https://other-domain.com/test.pdf
âŒ åº”è¯¥è¢«æ‹’ç»ï¼Œæ˜¾ç¤º"ä¸ä¿¡ä»»çš„æ–‡ä»¶æº"
```

### æµ‹è¯•é»‘åå•æ˜¯å¦ç”Ÿæ•ˆ

1. é…ç½®é»‘åå•ï¼š
```properties
not.trust.host = localhost,127.0.0.1
```

2. å°è¯•è®¿é—®æœ¬åœ°æ–‡ä»¶ï¼š
```
http://localhost:8012/getCorsFile?urlPath=http://127.0.0.1:8080/admin
âŒ åº”è¯¥è¢«æ‹’ç»
```

## ğŸ“‹ å¸¸è§é—®é¢˜

### Q1: å‡çº§åæ— æ³•é¢„è§ˆæ–‡ä»¶äº†ï¼Ÿ

**åŸå› **ï¼šæ–°ç‰ˆæœ¬é»˜è®¤æ‹’ç»æœªé…ç½®çš„ä¸»æœºã€‚

**è§£å†³**ï¼šåœ¨é…ç½®æ–‡ä»¶ä¸­æ·»åŠ ä¿¡ä»»ä¸»æœºåˆ—è¡¨ï¼š
```properties
trust.host = your-file-server.com
```

### Q2: å¦‚ä½•ä¸´æ—¶æ¢å¤æ—§ç‰ˆæœ¬è¡Œä¸ºï¼Ÿ

**ä¸æ¨è**ï¼Œä½†å¦‚æœç¡®å®éœ€è¦ï¼š
```properties
trust.host = *
```

### Q3: é…ç½®äº†ç™½åå•ä½†è¿˜æ˜¯æ— æ³•è®¿é—®ï¼Ÿ

æ£€æŸ¥ä»¥ä¸‹å‡ ç‚¹ï¼š
1. åŸŸåæ˜¯å¦å®Œå…¨åŒ¹é…ï¼ˆåŒºåˆ†å¤§å°å†™ï¼‰
2. æ˜¯å¦é…ç½®äº†é»‘åå•ï¼Œé»‘åå•ä¼˜å…ˆçº§æ›´é«˜
3. æŸ¥çœ‹æ—¥å¿—ä¸­çš„ WARNING ä¿¡æ¯
4. ç¡®è®¤ç¯å¢ƒå˜é‡æ˜¯å¦æ­£ç¡®è®¾ç½®

### Q4: å¦‚ä½•å…è®¸å­åŸŸåï¼Ÿ

ç›®å‰ä¸æ”¯æŒé€šé…ç¬¦åŸŸååŒ¹é…ï¼Œéœ€è¦æ˜ç¡®åˆ—å‡ºæ¯ä¸ªå­åŸŸåï¼š
```properties
trust.host = cdn.example.com,api.example.com,storage.example.com
```

## ğŸš¨ å®‰å…¨äº‹ä»¶å“åº”

å¦‚æœå‘ç°å¯ç–‘çš„é¢„è§ˆè¯·æ±‚ï¼š

1. æ£€æŸ¥æ—¥å¿—æ–‡ä»¶ï¼Œæœç´¢ "æ‹’ç»è®¿é—®ä¸»æœº" å…³é”®å­—
2. ç¡®è®¤ `trust.host` é…ç½®æ˜¯å¦åˆç†
3. æ£€æŸ¥æ˜¯å¦æœ‰å¼‚å¸¸çš„ç½‘ç»œè¯·æ±‚
4. å¦‚å‘ç°æ”»å‡»è¡Œä¸ºï¼ŒåŠæ—¶æ›´æ–°é»‘åå•é…ç½®

## ğŸ“ è·å–å¸®åŠ©

- GitHub Issues: https://github.com/kekingcn/kkFileView/issues
- Gitee Issues: https://gitee.com/kekingcn/file-online-preview/issues

---

**å®‰å…¨æç¤º**ï¼šå®šæœŸæ£€æŸ¥å’Œæ›´æ–°ä¿¡ä»»ä¸»æœºåˆ—è¡¨ï¼Œéµå¾ªæœ€å°æƒé™åŸåˆ™ã€‚
